package org.jlab.rec.rtpc.banks;

import java.util.ArrayList;
import java.util.List;

import org.jlab.io.base.DataBank;
import org.jlab.io.base.DataEvent;
import org.jlab.rec.rtpc.hit.Hit;
/**
 * @author payette
 *
 */
public class HitReader {

	private List<Hit> _Hits;
	
	/**
	 *
	 * @return a list of RTPC hits
	 */
	public List<Hit> get_RTPCHits() {
		return _Hits;
	}

	/**
	 *  sets the list of RTPC hits
	 * @param RTPCHits list of RTPC hits
	 */
	public void set_RTPCHits(List<Hit> RTPCHits) {
		this._Hits = RTPCHits;
	}

	

	
	/**
	 * reads the hits using clas-io methods to get the EvioBank for the RTPC and fill the values to instanciate the RTPChit and MChit classes.
	 * This methods fills the RTPChit and MChit list of hits.  If the data is not MC, the MChit list remains empty
	 * @param event DataEvent
	 */
	public void fetch_RTPCHits(DataEvent event) {

 

		List<Hit> hits = new ArrayList<Hit>();
		
                if(event.hasBank("RTPC::adc") && event.hasBank("RTPC::pos")) {
                    DataBank bankDGTZ = event.getBank("RTPC::adc");
                    DataBank bankTrue = event.getBank("RTPC::pos");
		
                    int rows = bankDGTZ.rows();
                    if(bankTrue.rows()!=rows)
                            return;

                    int[] hitnb 	= new int[rows];
                    int[] cellID 	= new int[rows];
                    //int[] ADC 		= new int[rows];
                    double[] Time	= new double[rows];
                    int[] step 		= new int[rows];
                    double[] posX 	= new double[rows];
                    double[] posY 	= new double[rows];
                    double[] posZ 	= new double[rows];
                    //double[] phiRad = new double[rows];
                    double[] Edep = new double[rows];
		
                    bankTrue.show();
			for(int i = 0; i<rows; i++){
				
				hitnb[i] 	= i+1;
				cellID[i] 	= bankDGTZ.getInt("component", i);
				//ADC[i]		= bankDGTZ.getInt("ADC", i);
				Time[i]		= (double) bankTrue.getFloat("time", i);
				step[i]		= bankTrue.getInt("step", i);
                                Edep[i]     = (double) bankTrue.getFloat("energy", i);
			    
			    
			    
				posX[i] 	= (double) bankTrue.getFloat("posx", i);
				posY[i] 	= (double) bankTrue.getFloat("posy", i);
				posZ[i] 	= (double) bankTrue.getFloat("posz", i);
				
				if(Time[i] <= 0 || Time[i] > 10000) 
			    {
					Time[i] = 0;
			    		Edep[i] = 0;
			    		posX[i] = 0;
			    		posY[i] = 0;
			    		posZ[i] = 0;
		    		}
				
				Hit hit = new Hit(1, cellID[i], 1, Time[i]);
				hit.set_EdepTrue(Edep[i]);
				hit.set_PosXTrue(posX[i]);
				hit.set_PosYTrue(posY[i]);
				hit.set_PosZTrue(posZ[i]);
				hit.set_Time(Time[i]);
				
				

				hits.add(hit); 
			}
		}
		
		/*
		int[] cellID = {3450,3450,3451,3450,3251,3051,3051,2951,2951,2951,2750,2750,2551,2451,2451,2351,2251,2251,2052,1951,2052,1851,1851,1752,1652,1451,1352,1252,1252,1151,1052,852,952,852,752,752,552,652,453,352,252,152,53,53,18053,17852,17852,17753,17653};
		//System.out.println("cellID " + cellID.length);
		double[] Time = {5895.85774588,5839.12261943,5862.23018446,5845.05585172,5664.22060509,5604.29232077,5622.32635545,5475.65493834,5561.33278734,5543.13415021,5395.05751246,5408.45806171,5270.29669543,5207.25237687,5147.65301052,5065.39306031,5030.89763352,4843.77727389,4721.08781552,4758.16742099,4669.40427246,4562.7187813,4518.50234734,4370.45333913,4354.97843317,4135.29434063,3993.03406628,3888.10915138,3769.00037442,3801.6594711,3531.14977435,3329.11373602,3460.03106923,3196.58189995,3157.59940782,3105.72007838,2818.09088046,2870.33656468,2625.94126314,2542.64647147,2349.08250854,2138.32296942,1933.06237405,1851.45423732,1767.81464686,1523.9544315,1430.14490628,1125.79793427,1052.6499997};
		double[] Edep = {0.00218542690516,0.00164830563027,0.00235728064443,0.00423563132209,0.00184206645689,0.00341255183562,0.00027521869518,0.00669033788075,0.000909174606238,0.00278569348,0.0012520306994,0.00300658176582,0.00254923339349,0.00246813409598,0.00107736491346,0.00289968628567,0.00164372594709,0.00347930900959,0.00215561272068,0.00402360853311,0.000920200363298,0.0045917812945,0.00248134841855,0.00342035615883,0.00557614740376,0.00559940721331,0.00391853708795,0.00355952523752,0.00509064555761,0.0040349022227,0.0031528388475,0.00483334552353,0.00126628821279,0.0025966543959,0.0058258566319,0.000685529175631,0.0063896395014,0.00601908472413,0.00379466718462,0.00135917088469,0.00546826158697,0.00407847936993,0.00450339244988,0.00340362257175,0.000880883896384,0.00440500528211,0.00720770488465,0.0055423558654,0.003802153106};
		double[] posX = {30.4378555844,31.0018319509,31.4563059835,31.8018366323,32.3274394202,33.6689195557,34.4030674872,35.3497916114,34.8482621923,36.1670383209,36.7793072403,37.1045784167,37.9526537222,38.8449243541,39.4066417847,39.9724995612,40.5845961653,41.5243216181,42.5653820279,43.3813570378,43.3150008304,44.2596144676,45.1332865987,46.2545803213,47.0130341407,48.0541902978,49.0051290143,49.9741993491,51.0156632315,51.6248819409,52.8589895835,53.846101374,53.4394573117,54.7554175072,55.7496489474,55.9167873601,56.9760672006,57.6850820994,58.6372125212,59.0725823212,59.8796277943,60.8834349258,61.9545787956,62.6628896929,63.346648669,64.1462631107,65.0878914323,66.1451971057,66.840476836};
		double[] posY = {2.04794633635,1.94366287865,1.87064770476,1.80141747348,1.67594413152,1.37477647073,1.19822792019,0.977189243553,1.08572968904,0.733388486362,0.555644735315,0.466670529828,0.198981733616,-0.0890756029378,-0.277588507332,-0.4750910206,-0.695321703072,-1.0481562619,-1.45913531467,-1.79682405005,-1.76815416376,-2.17435764319,-2.56659563018,-3.09686622484,-3.46620421432,-4.00521146097,-4.51913092854,-5.06242617999,-5.64444672753,-6.04031925167,-6.82508906839,-7.48187431998,-7.20643095433,-8.10961486051,-8.82291554662,-8.9457945815,-9.74533762037,-10.3018621127,-11.082443343,-11.4486807235,-12.1471727769,-13.0528605212,-14.065451173,-14.7633792027,-15.4584782972,-16.3063675415,-17.3328644562,-18.5596220563,-19.3923926386};
		double[] posZ = {5.72975977605,5.83928027885,5.93832298981,5.85362537735,6.09693156967,6.35900433326,6.50289760416,6.82792771479,6.59028124793,6.85098327651,6.9723237933,7.01693730171,7.20697409211,7.38723293696,7.50142036004,7.61725596691,7.74318348121,7.93742909041,8.15318312356,8.32330163674,8.3089872297,8.5107031227,8.69953518305,8.94616142827,9.10326004486,9.37419061761,9.56595337268,9.78779072083,9.93528790463,10.1516465379,10.4628113737,10.6994982422,10.601447713,10.9199400905,11.1597907124,11.2049265429,11.4582556054,11.6402418736,11.8962429905,12.0104127925,12.2245413741,12.4953509757,12.791442291,12.9921400422,13.1895681604,13.4267081821,13.7126973761,14.0378164925,14.2656414838};
		for(int i = 0; i< cellID.length; i++)
		{
			Hit hit = new Hit(1, cellID[i], 1, Time[i]);
			hit.set_EdepTrue(Edep[i]);
			hit.set_PosXTrue(posX[i]);
			hit.set_PosYTrue(posY[i]);
			hit.set_PosZTrue(posZ[i]);
			hit.set_Time(Time[i]);

			hits.add(hit); 
			
		}*/
	      this.set_RTPCHits(hits);

	}
}
